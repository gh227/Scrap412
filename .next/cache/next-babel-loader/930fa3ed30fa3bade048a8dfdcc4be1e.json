{"ast":null,"code":"import nextConnect from 'next-connect';\nimport { nanoid } from 'nanoid';\nimport middleware from '../../../middlewares/middleware';\nimport cors from 'cors';\nconst handler = nextConnect();\n\nfunction checkip(req, res) {\n  let ip = req.ip || req.connection.remoteAddress || req.connection.socket.remoteAddress;\n  let ip_reg = ip.match(/[0-9].?/g).join('');\n\n  if (ip_reg === \"127.0.0.1\") {\n    res.send('not found');\n  } else {\n    next();\n  }\n}\n\nhandler.use(cors({\n  origin: 'https://ifactonews.com',\n  HttpOnly: true\n})).use(middleware);\nhandler.get(async (req, res) => {\n  checkip(req, res);\n  const posts = await req.db.collection('posts').find({}).sort({\n    createdAt: -1\n  }).toArray();\n  res.send({\n    posts\n  });\n});\nhandler.post(async (req, res) => {\n  if (!req.user) {\n    return res.status(401).send('unauthenticated');\n  }\n\n  const {\n    image_link,\n    caption,\n    author,\n    source,\n    source_link,\n    category,\n    headings,\n    abstract_cat,\n    content\n  } = req.body;\n  if (!content) return res.status(400).send('You must write something');\n  const post = {\n    _id: nanoid(),\n    image_link,\n    caption,\n    author,\n    source,\n    source_link,\n    category,\n    headings,\n    abstract_cat,\n    content,\n    createdAt: new Date(),\n    creatorId: req.user._id,\n    updatedAt: ''\n  };\n  await req.db.collection('posts').insertOne(post);\n  return res.send(post);\n});\nhandler.put(async (req, res) => {\n  const {\n    post_id,\n    image_link,\n    caption,\n    author,\n    source,\n    source_link,\n    category,\n    headings,\n    abstract_cat,\n    content\n  } = req.body;\n  const myQuery = {\n    _id: post_id\n  };\n  const updateValues = {\n    $set: {\n      image_link,\n      caption,\n      author,\n      source,\n      source_link,\n      category,\n      headings,\n      abstract_cat,\n      content,\n      updatedAt: new Date()\n    }\n  };\n  await req.db.collection(\"posts\").updateOne(myQuery, updateValues, function (err, res) {\n    if (err) throw err;\n  });\n  res.send('welcome update');\n});\nhandler.delete(async (req, res) => {\n  const {\n    post_id\n  } = req.body;\n  console.log(req.body);\n  await req.db.collection('posts').deleteOne({\n    _id: post_id\n  }, (err, obj) => {\n    if (err) throw err;\n    console.log(obj);\n  });\n  res.send(\"sucessfull\");\n});\nexport default handler;","map":{"version":3,"sources":["c:/Users/hero/Documents/projects/Next/pages/api/posts/index.js"],"names":["nextConnect","nanoid","middleware","cors","handler","checkip","req","res","ip","connection","remoteAddress","socket","ip_reg","match","join","send","next","use","origin","HttpOnly","get","posts","db","collection","find","sort","createdAt","toArray","post","user","status","image_link","caption","author","source","source_link","category","headings","abstract_cat","content","body","_id","Date","creatorId","updatedAt","insertOne","put","post_id","myQuery","updateValues","$set","updateOne","err","delete","console","log","deleteOne","obj"],"mappings":"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","sourcesContent":["import nextConnect from 'next-connect';\nimport { nanoid } from 'nanoid';\nimport middleware from '../../../middlewares/middleware';\nimport cors from 'cors'\n\nconst handler = nextConnect();\n\n\n\n\nfunction checkip(req, res){\n  let ip = req.ip|| req.connection.remoteAddress||req.connection.socket.remoteAddress;\n  let ip_reg = ip.match(/[0-9].?/g).join('')\n  if(ip_reg === \"127.0.0.1\"){\n    res.send('not found');\n  }else{\n    next();\n  }\n}\nhandler.use(cors({origin:'https://ifactonews.com', HttpOnly:true})).use(middleware);\n\nhandler.get(async (req, res) => {\n  checkip(req, res);\n  const posts = await req.db\n    .collection('posts')\n    .find({})\n    .sort({createdAt:-1})\n    .toArray();\n  res.send({posts})\n});\n\nhandler.post(async (req, res) => {\n    \n  if (!req.user) {\n    return res.status(401).send('unauthenticated');\n  }\n\n  const { image_link, caption, author, source, source_link, \n    category, headings, abstract_cat, content} = req.body;\n\n  if (!content) return res.status(400).send('You must write something');\n\n  const post = {\n    _id: nanoid(),\n    image_link, \n    caption, \n    author, \n    source, \n    source_link, \n    category, \n    headings, \n    abstract_cat, \n    content,\n    createdAt: new Date(),\n    creatorId: req.user._id,\n    updatedAt:''\n  };\n\n  await req.db.collection('posts').insertOne(post);\n  return res.send(post);\n});\n\nhandler.put( async(req, res)=>{\n  \n  const {post_id, image_link, caption, author, source, source_link, \n    category, headings, abstract_cat, content} = req.body;\n  \n    const myQuery = {_id:post_id};\n    const updateValues = {$set:{\n    image_link, \n    caption, \n    author, \n    source, \n    source_link, \n    category, \n    headings, \n    abstract_cat, \n    content,\n    updatedAt:new Date(),\n    }};\n\n    await req.db.collection(\"posts\").updateOne(myQuery, updateValues, function(err, res) {\n      if (err) throw err;\n      \n    });\n  res.send('welcome update')\n})\n\nhandler.delete(async(req, res)=>{\n  const {post_id} = req.body;\nconsole.log(req.body);\n  await req.db.collection('posts').deleteOne({_id:post_id}, (err, obj)=>{\n      if(err) throw err;\n    console.log(obj)\n  });\n  res.send(\"sucessfull\");\n})\n\n\n\nexport default handler;\n"]},"metadata":{},"sourceType":"module"}