{"ast":null,"code":"import passport from 'passport';\nimport bcrypt from 'bcryptjs';\nimport { Strategy as LocalStrategy } from 'passport-local';\npassport.serializeUser((user, done) => {\n  done(null, user._id);\n});\npassport.deserializeUser((req, id, done) => {\n  req.db.collection('users').findOne({\n    _id: id\n  }).then(user => done(null, user));\n});\npassport.use(new LocalStrategy({\n  usernameField: 'email',\n  passReqToCallback: true\n}, async (req, email, password, done) => {\n  const user = await req.db.collection('users').findOne({\n    email\n  });\n  if (user && (await bcrypt.compare(password, user.password))) done(null, user);else done(null, false, {\n    message: 'Email or password is incorrect'\n  });\n}));\nexport default passport;","map":{"version":3,"sources":["c:/Users/hero/Documents/projects/Next/lib/passport.js"],"names":["passport","bcrypt","Strategy","LocalStrategy","serializeUser","user","done","_id","deserializeUser","req","id","db","collection","findOne","then","use","usernameField","passReqToCallback","email","password","compare","message"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,UAArB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SAASC,QAAQ,IAAIC,aAArB,QAA0C,gBAA1C;AAEAH,QAAQ,CAACI,aAAT,CAAuB,CAACC,IAAD,EAAOC,IAAP,KAAgB;AACrCA,EAAAA,IAAI,CAAC,IAAD,EAAOD,IAAI,CAACE,GAAZ,CAAJ;AACD,CAFD;AAIAP,QAAQ,CAACQ,eAAT,CAAyB,CAACC,GAAD,EAAMC,EAAN,EAAUJ,IAAV,KAAmB;AAC1CG,EAAAA,GAAG,CAACE,EAAJ,CACGC,UADH,CACc,OADd,EAEGC,OAFH,CAEW;AAAEN,IAAAA,GAAG,EAAEG;AAAP,GAFX,EAGGI,IAHH,CAGST,IAAD,IAAUC,IAAI,CAAC,IAAD,EAAOD,IAAP,CAHtB;AAID,CALD;AAOAL,QAAQ,CAACe,GAAT,CACE,IAAIZ,aAAJ,CACE;AAAEa,EAAAA,aAAa,EAAE,OAAjB;AAA0BC,EAAAA,iBAAiB,EAAE;AAA7C,CADF,EAEE,OAAOR,GAAP,EAAYS,KAAZ,EAAmBC,QAAnB,EAA6Bb,IAA7B,KAAsC;AACpC,QAAMD,IAAI,GAAG,MAAMI,GAAG,CAACE,EAAJ,CAAOC,UAAP,CAAkB,OAAlB,EAA2BC,OAA3B,CAAmC;AAAEK,IAAAA;AAAF,GAAnC,CAAnB;AACA,MAAIb,IAAI,KAAK,MAAMJ,MAAM,CAACmB,OAAP,CAAeD,QAAf,EAAyBd,IAAI,CAACc,QAA9B,CAAX,CAAR,EAA6Db,IAAI,CAAC,IAAD,EAAOD,IAAP,CAAJ,CAA7D,KACKC,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEe,IAAAA,OAAO,EAAE;AAAX,GAAd,CAAJ;AACN,CANH,CADF;AAWA,eAAerB,QAAf","sourcesContent":["import passport from 'passport';\nimport bcrypt from 'bcryptjs';\nimport { Strategy as LocalStrategy } from 'passport-local';\n\npassport.serializeUser((user, done) => {\n  done(null, user._id);\n});\n\npassport.deserializeUser((req, id, done) => {\n  req.db\n    .collection('users')\n    .findOne({ _id: id })\n    .then((user) => done(null, user));\n});\n\npassport.use(\n  new LocalStrategy(\n    { usernameField: 'email', passReqToCallback: true },\n    async (req, email, password, done) => {\n      const user = await req.db.collection('users').findOne({ email });\n      if (user && (await bcrypt.compare(password, user.password))) done(null, user);\n      else done(null, false, { message: 'Email or password is incorrect' });\n    },\n  ),\n);\n\nexport default passport;\n"]},"metadata":{},"sourceType":"module"}