{"ast":null,"code":"import nextConnect from 'next-connect';\nimport isEmail from 'validator/lib/isEmail';\nimport normalizeEmail from 'validator/lib/normalizeEmail';\nimport bcrypt from 'bcryptjs';\nimport { nanoid } from 'nanoid';\nimport middleware from '../../middlewares/middleware';\nimport { extractUser } from '../../lib/api-helper';\nconst handler = nextConnect();\nhandler.use(middleware);\nhandler.get(async (req, res) => {\n  res.send(\"working\");\n});\nhandler.post(async (req, res) => {\n  const email = normalizeEmail(req.email);\n  const {\n    name,\n    password\n  } = req.body;\n\n  if (!isEmail) {\n    res.status(400).send(\"invalid email\");\n  }\n\n  if (!name) {\n    res.status(400).send(\"Name is  required\");\n  }\n\n  if (!password) {\n    res.status(400).send(\"Password is required\");\n  }\n\n  if ((await req.db.collection('users').countDocuments({\n    email\n  })) > 0) {\n    res.status(400).send(\"Email already exist\");\n  }\n\n  const hashedPassword = await bcrypt.hash(password, 10);\n  const user = await req.db.collection('users').insertOne({\n    _id: nanoid(12),\n    name,\n    email,\n    password: hashedPassword,\n    isVerified: false\n  }).then(({\n    ops\n  }) => ops[0]);\n  res.logIn(user, err => {\n    if (err) throw err;\n    res.status(201).json({\n      user: extractUser(req)\n    });\n  });\n});\nexport default handler;","map":{"version":3,"sources":["C:/Users/hero/Documents/projects/Next/pages/api/users.js"],"names":["nextConnect","isEmail","normalizeEmail","bcrypt","nanoid","middleware","extractUser","handler","use","get","req","res","send","post","email","name","password","body","status","db","collection","countDocuments","hashedPassword","hash","user","insertOne","_id","isVerified","then","ops","logIn","err","json"],"mappings":"AAAA,OAAOA,WAAP,MAAwB,cAAxB;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,OAAOC,cAAP,MAA2B,8BAA3B;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SAASC,MAAT,QAAuB,QAAvB;AACA,OAAOC,UAAP,MAAuB,8BAAvB;AACA,SAASC,WAAT,QAA4B,sBAA5B;AAEA,MAAMC,OAAO,GAAGP,WAAW,EAA3B;AAEAO,OAAO,CAACC,GAAR,CAAYH,UAAZ;AACAE,OAAO,CAACE,GAAR,CAAY,OAAOC,GAAP,EAAYC,GAAZ,KAAkB;AAC1BA,EAAAA,GAAG,CAACC,IAAJ,CAAS,SAAT;AACH,CAFD;AAGAL,OAAO,CAACM,IAAR,CAAa,OAAOH,GAAP,EAAYC,GAAZ,KAAkB;AAC3B,QAAMG,KAAK,GAAIZ,cAAc,CAACQ,GAAG,CAACI,KAAL,CAA7B;AACA,QAAM;AAACC,IAAAA,IAAD;AAAOC,IAAAA;AAAP,MAAmBN,GAAG,CAACO,IAA7B;;AACA,MAAG,CAAChB,OAAJ,EAAY;AACRU,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBN,IAAhB,CAAqB,eAArB;AACH;;AACD,MAAG,CAACG,IAAJ,EAAS;AACLJ,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBN,IAAhB,CAAqB,mBAArB;AACH;;AACD,MAAG,CAACI,QAAJ,EAAa;AACTL,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBN,IAAhB,CAAqB,sBAArB;AACH;;AACD,MAAI,OAAMF,GAAG,CAACS,EAAJ,CAAOC,UAAP,CAAkB,OAAlB,EAA2BC,cAA3B,CAA0C;AAACP,IAAAA;AAAD,GAA1C,CAAN,IAAyD,CAA7D,EAAgE;AAC5DH,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBN,IAAhB,CAAqB,qBAArB;AACH;;AACD,QAAMU,cAAc,GAAG,MAAMnB,MAAM,CAACoB,IAAP,CAAYP,QAAZ,EAAqB,EAArB,CAA7B;AACA,QAAMQ,IAAI,GAAG,MAAMd,GAAG,CAACS,EAAJ,CAAOC,UAAP,CAAkB,OAAlB,EAA2BK,SAA3B,CACf;AACIC,IAAAA,GAAG,EAACtB,MAAM,CAAC,EAAD,CADd;AAEIW,IAAAA,IAFJ;AAGID,IAAAA,KAHJ;AAIIE,IAAAA,QAAQ,EAACM,cAJb;AAKIK,IAAAA,UAAU,EAAC;AALf,GADe,EAQjBC,IARiB,CAQZ,CAAC;AAACC,IAAAA;AAAD,GAAD,KAASA,GAAG,CAAC,CAAD,CARA,CAAnB;AASAlB,EAAAA,GAAG,CAACmB,KAAJ,CAAUN,IAAV,EAAiBO,GAAD,IAAO;AACnB,QAAGA,GAAH,EAAQ,MAAMA,GAAN;AACRpB,IAAAA,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBc,IAAhB,CAAqB;AACjBR,MAAAA,IAAI,EAAClB,WAAW,CAACI,GAAD;AADC,KAArB;AAGH,GALD;AAMH,CA/BD;AAiCA,eAAeH,OAAf","sourcesContent":["import nextConnect from 'next-connect';\r\nimport isEmail from 'validator/lib/isEmail';\r\nimport normalizeEmail from 'validator/lib/normalizeEmail';\r\nimport bcrypt from 'bcryptjs';\r\nimport { nanoid } from 'nanoid';\r\nimport middleware from '../../middlewares/middleware';\r\nimport { extractUser } from '../../lib/api-helper';\r\n\r\nconst handler = nextConnect();\r\n\r\nhandler.use(middleware)\r\nhandler.get(async (req, res)=>{\r\n    res.send(\"working\")\r\n})\r\nhandler.post(async (req, res)=>{\r\n    const email =  normalizeEmail(req.email)\r\n    const {name, password} = req.body;\r\n    if(!isEmail){\r\n        res.status(400).send(\"invalid email\")\r\n    }\r\n    if(!name){\r\n        res.status(400).send(\"Name is  required\")\r\n    }\r\n    if(!password){\r\n        res.status(400).send(\"Password is required\")\r\n    }\r\n    if((await req.db.collection('users').countDocuments({email})>0)){\r\n        res.status(400).send(\"Email already exist\")\r\n    }\r\n    const hashedPassword = await bcrypt.hash(password,10);\r\n    const user = await req.db.collection('users').insertOne(\r\n        {\r\n            _id:nanoid(12),\r\n            name,\r\n            email,\r\n            password:hashedPassword,\r\n            isVerified:false,\r\n        }\r\n    ).then(({ops})=>ops[0]);\r\n    res.logIn(user, (err)=>{\r\n        if(err) throw err;\r\n        res.status(201).json({\r\n            user:extractUser(req)\r\n        })\r\n    })\r\n})\r\n\r\nexport default handler;"]},"metadata":{},"sourceType":"module"}