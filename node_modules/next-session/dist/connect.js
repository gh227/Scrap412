"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("./core");
let storeReady = true;
function session(opts) {
    var _a;
    //  store readiness
    if ((_a = opts === null || opts === void 0 ? void 0 : opts.store) === null || _a === void 0 ? void 0 : _a.on) {
        opts.store.on('disconnect', () => {
            storeReady = false;
        });
        opts.store.on('connect', () => {
            storeReady = true;
        });
    }
    return (req, res, next) => {
        if (!storeReady) {
            next();
            return;
        }
        core_1.applySession(req, res, opts).then(next);
    };
}
exports.default = session;
